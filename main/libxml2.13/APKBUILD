# Contributor: Carlo Landmeter <clandmeter@alpinelinux.org>
# Maintainer: Carlo Landmeter <clandmeter@alpinelinux.org>
pkgname=libxml2.13
pkgver=2.13.7
pkgrel=0
pkgdesc="XML parsing library, version 2.13 (for compatibility reasons)"
url="https://gitlab.gnome.org/GNOME/libxml2"
arch="all"
license="MIT"
depends_dev="zlib-dev xz-dev"
checkdepends="perl tar"
makedepends_host="$depends_dev"
source="https://download.gnome.org/sources/libxml2/${pkgver%.*}/libxml2-$pkgver.tar.xz"
builddir="$srcdir/libxml2-$pkgver"

# secfixes:
#   2.13.6-r0:
#     - CVE-2025-24928
#     - CVE-2024-56171
#     - CVE-2025-27113
#   2.12.7-r0:
#     - CVE-2024-34459
#   2.12.5-r0:
#     - CVE-2024-25062
#   2.10.4-r0:
#     - CVE-2023-28484
#     - CVE-2023-29469
#   2.10.3-r0:
#     - CVE-2022-40303
#     - CVE-2022-40304
#   2.10.0-r0:
#     - CVE-2022-2309
#   2.9.14-r0:
#     - CVE-2022-29824
#   2.9.13-r0:
#     - CVE-2022-23308
#   2.9.11-r0:
#     - CVE-2016-3709
#     - CVE-2021-3517
#     - CVE-2021-3518
#     - CVE-2021-3537
#     - CVE-2021-3541
#   2.9.10-r5:
#     - CVE-2020-24977
#   2.9.10-r4:
#     - CVE-2019-20388
#   2.9.8-r3:
#     - CVE-2020-7595
#   2.9.8-r1:
#     - CVE-2018-9251
#     - CVE-2018-14404
#     - CVE-2018-14567
#   2.9.4-r4:
#     - CVE-2017-5969
#   2.9.4-r2:
#     - CVE-2016-9318
#   2.9.4-r1:
#     - CVE-2016-5131

prepare() {
	default_prepare

	# We don't build libxml2 with icu.
	rm test/icu_parse_test.xml
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--enable-static \
		--with-legacy \
		--with-lzma \
		--with-zlib \
		--with-python=no
	make
}

check() {
	rm -f test/ebcdic_566012.xml
	make runtests
}

package() {
	install -Dm644 .libs/libxml2.so.2* -t "$pkgdir"/usr/lib/
}

sha512sums="
6e69ed38cdf2aaa5df7e26b654a7aadd2d80131619184380bafc6a22811acb6b7286c819175c3b37edb194019a93ba6085852a0281934d6bb36d0b52ce138541  libxml2-2.13.7.tar.xz
"
