Patch-Source: https://github.com/llvm/llvm-project/commit/f5ad8dc6876ab667d07fe6c3bd2ac2bad434f6fb
---
From f619f91d6500aa91bdda252159916a0e913e95f7 Mon Sep 17 00:00:00 2001
From: Jessica Clarke <jrtc27@jrtc27.com>
Date: Sun, 3 Aug 2025 21:28:48 +0100
Subject: [PATCH] Fix host endianness assumption

Fixes: b42f96bc057f ("[lld] Add thunks for hexagon (#111217)")
(cherry picked from commit 723b40a8d92f76fc913ef21061fc3d74e8c47441)
Signed-off-by: Achill Gilgenast <achill@achill.org>
---
 ELF/Relocations.cpp | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/ELF/Relocations.cpp b/ELF/Relocations.cpp
index 2ee308a2d1b3..c10ffc5f6bbd 100644
--- a/ELF/Relocations.cpp
+++ b/ELF/Relocations.cpp
@@ -2153,10 +2153,8 @@ static int getHexagonPacketOffset(const InputSection &isec,
   for (unsigned i = 0;; i++) {
     if (i == 3 || rel.offset < (i + 1) * 4)
       return i * 4;
-    uint32_t instWord = 0;
-    const ArrayRef<uint8_t> instWordContents =
-        data.drop_front(rel.offset - (i + 1) * 4);
-    memcpy(&instWord, instWordContents.data(), sizeof(instWord));
+    uint32_t instWord =
+        read32(isec.getCtx(), data.data() + (rel.offset - (i + 1) * 4));
     if (((instWord & HEXAGON_MASK_END_PACKET) == HEXAGON_END_OF_PACKET) ||
         ((instWord & HEXAGON_MASK_END_PACKET) == HEXAGON_END_OF_DUPLEX))
       return i * 4;
-- 
2.50.1

