maintainer="fossdd <fossdd@pwned.life>"
pkgname=cellbroadcastd
pkgver=0.0.1
pkgrel=0
_gvdb_commit="4758f6fb7f889e074e13df3f914328f3eecb1fd3"
pkgdesc="Manages cell broadcast messages received via ModemManager"
url="https://gitlab.freedesktop.org/devrtz/cellbroadcastd"
arch="all"
license="LGPL-2.1-or-later"
makedepends="
	glib-dev
	gmobile-dev
	gobject-introspection-dev
	meson
	mobile-broadband-provider-info
	modemmanager-dev
	"
checkdepends="dbus"
subpackages="$pkgname-libs $pkgname-dev"
source="https://fortysixandtwo.eu/releases/cbd-$pkgver.tar.xz
	https://gitlab.gnome.org/GNOME/gvdb/-/archive/$_gvdb_commit/gvdb-$_gvdb_commit.tar.gz
	fix-arm-test.patch
	fix-syms.patch
	"
builddir="$srcdir/cbd-$pkgver"

prepare() {
	default_prepare

	mkdir -p subprojects/gvdb
	mv "$srcdir"/gvdb*/* subprojects/gvdb
}

build() {
	abuild-meson \
		output .
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output

	# We don't ship systemd
	rm -r "$pkgdir"/usr/lib/systemd
}

sha512sums="
dec65ca84523158415d14000cbc7d96de21418f87301b6fe5c773b65cb3064ea1b88371546e0993f5b17b6727887b5c32ef1e8743ef1decbca8ba70451fcb435  cbd-0.0.1.tar.xz
0898260dd60ab34c7621829ecccf16bfb16506d6edd912bf4b3506526485a30b5f79ad56696aece4ec9e47913c4cee8080c333258ee9b0987236485801962eb7  gvdb-4758f6fb7f889e074e13df3f914328f3eecb1fd3.tar.gz
e2b15efbc510b1e88ed40f2391955ad49655220c5ac040c8b00ae244c61f34cf09456269149851cf2257e8e47930b109873b57e746153245830b96871118179f  fix-arm-test.patch
c0044524e9873d3f4b32eb30a6628cf642a9f8eb7b864ab6b9c3c8fc7df3487b0f381da06c48a61773c5994010235fedc5bd6de8fb041764fe96924e3a1dabfa  fix-syms.patch
"
